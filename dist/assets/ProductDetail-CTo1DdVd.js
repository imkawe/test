import{k as Z,u as G,a as Q,r as i,j as a,b as r,h as R,n as ee,o as T,p as te,q as J,s as ae,t as V}from"./index-CT1dYHP2.js";const re="/assets/minute_delivery-Dy-Y-4Jr.png",se="/assets/Best_Prices_Offers-RyfnVrR5.png",le="/assets/Wide_Assortment-BswfXy3t.png",ce=()=>{const{id:$}=Z(),b=G(),{user:j}=Q(),[m,v]=i.useState([]),[s,B]=i.useState(null),[y,N]=i.useState(0),[L,q]=i.useState({}),[n,I]=i.useState(""),[c,w]=i.useState(""),[S,F]=i.useState([]),E=i.useRef(),x=e=>{if(Array.isArray(e))return e;if(typeof e=="string"&&e.startsWith("["))try{return JSON.parse(e)}catch{return[e]}return[e]},U=(()=>{try{const e=s!=null&&s.more_details?typeof s.more_details=="string"?JSON.parse(s.more_details):s.more_details:{};return{colors:e.colors||[],sizes:e.sizes||[],colorImages:e.colorImages||{},inventory:e.inventory||{},specs:e.specs||{},rating:e.rating||null}}catch(e){return console.error("Error parsing details:",e),{colors:[],sizes:[],colorImages:{},inventory:{},specs:{},rating:null}}})(),{colors:p,sizes:d,inventory:h,specs:P,rating:k,colorImages:A}=U,K=n?d.filter(e=>{var t;return((t=h[n])==null?void 0:t[e])>0}):d;i.useEffect(()=>{(async()=>{try{const t=await fetch(`https://cloudflare-d1.ujhuji.workers.dev/api/products/${$}`);if(!t.ok)throw new Error("Producto no encontrado");const l=await t.json();B({...l,image:x(l.image)}),I(""),w("")}catch(t){console.error("Error fetching product:",t),b("/404")}})()},[$,b]),i.useEffect(()=>{n&&A[n]?F(x(A[n])):F(x(s==null?void 0:s.image)),N(0)},[n,s]),i.useEffect(()=>{(()=>{try{const t=JSON.parse(sessionStorage.getItem("cart")||"[]");v(t)}catch(t){console.error("Error loading cart:",t),sessionStorage.removeItem("cart"),v([])}})()},[]);const M=e=>{const t=e.filter(l=>(l==null?void 0:l.id)&&typeof l.quantity=="number"&&l.quantity>0&&l.stock>=l.quantity);v(t),sessionStorage.setItem("cart",JSON.stringify(t)),window.dispatchEvent(new Event("cartUpdated"))},z=(()=>{var e;return n&&c?((e=h[n])==null?void 0:e[c])||0:n&&d.length===0?h[n]||0:n&&d.length>0?Object.values(h[n]||{}).reduce((t,l)=>t+l,0):(s==null?void 0:s.stock)||0})(),o=m.find(e=>e.id===(s==null?void 0:s.id)&&e.color===n&&e.size===c),g=z-((o==null?void 0:o.quantity)||0),C=(e=1)=>((s==null?void 0:s.price)*(s.discount/100)*e).toFixed(2),O=()=>{if(!j||!s)return;if(p.length>0&&!n){alert("Por favor selecciona un color");return}if(d.length>0&&!c){alert("Por favor selecciona una talla");return}const e={id:s.id,name:s.name,price:s.price,image:S[0]||s.image[0],discount:s.discount||0,stock:z,color:n,size:c,quantity:1},t=m.findIndex(u=>u.id===e.id&&u.color===e.color&&u.size===e.size),l=[...m];t>-1?l[t].quantity+=1:l.push(e),M(l)},W=()=>{const e=m.findIndex(l=>l.id===(s==null?void 0:s.id)&&l.color===n&&l.size===c);if(e===-1)return;const t=[...m];t[e].quantity>1?t[e].quantity-=1:t.splice(e,1),M(t)},_=e=>{var t;(t=E.current)==null||t.scrollBy({left:e*200,behavior:"smooth"})},X=e=>{const t=e.currentTarget.getBoundingClientRect(),l=(e.clientX-t.left)/t.width*100,u=(e.clientY-t.top)/t.height*100;q({transformOrigin:`${l}% ${u}%`,transform:"scale(2)"})},Y=()=>{q({transform:"scale(1)"})};if(!s)return a("div",{className:"text-center py-20 text-gray-600",children:"Cargando detalles del producto..."});const D=s.discount>0?(s.price*(1-s.discount/100)).toFixed(2):s.price.toFixed(2),f=S.length?S:x(s.image),H=f[y]||"/placeholder.jpg";return r("section",{className:"container mx-auto px-4 py-8",children:[r("div",{className:"mb-8",children:[a("h1",{className:"text-3xl font-bold text-gray-900 mb-2 tracking-tight leading-tight max-w-4xl",children:s.name}),r("div",{className:"flex items-center gap-3 text-lg text-gray-500",children:[r("span",{className:"font-medium",children:["SKU: HDK8566698ID",s.id]}),k&&r(R,{children:[a("span",{className:"text-emerald-600",children:"•"}),r("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((e,t)=>a(ee,{className:`text-sm ${t<Math.floor(k.average)?"text-yellow-400":"text-gray-300"}`},t)),r("span",{className:"font-medium",children:["(",k.count,")"]})]})]})]})]}),r("div",{className:"grid lg:grid-cols-2 gap-10 max-w-7xl",children:[r("div",{className:"space-y-6",children:[a("div",{className:"relative group bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-2xl",children:r("div",{className:"aspect-square relative transition-transform duration-300",onMouseMove:X,onMouseLeave:Y,children:[a("img",{src:H,className:"w-full h-full object-contain transition-all duration-300",style:L,alt:s.name}),s.discount>0&&r("div",{className:"absolute top-5 left-5 bg-gradient-to-r from-red-600 to-red-500 text-white px-4 py-2 rounded-full flex items-center gap-2 shadow-lg transform -rotate-2",children:[a(T,{className:"text-sm"}),r("span",{className:"font-bold",children:[s.discount,"% OFF"]})]})]})}),f.length>1&&r("div",{className:"relative",children:[a("div",{className:"flex justify-center gap-2 mb-3",children:f.map((e,t)=>a("button",{className:`h-2 w-10 rounded-full transition-all ${t===y?"bg-emerald-600":"bg-gray-200 hover:bg-gray-300"}`,onClick:()=>N(t),"aria-label":`Ver imagen ${t+1}`},`indicator-${t}`))}),r("div",{className:"relative group",children:[a("div",{ref:E,className:"flex gap-4 overflow-x-auto scrollbar-hide pb-4",children:f.map((e,t)=>a("button",{onClick:()=>N(t),className:`flex-shrink-0 w-24 h-24 transition-all duration-300 ${t===y?"ring-3 ring-emerald-500 scale-105 shadow-md":"opacity-75 hover:opacity-100 hover:ring-2 ring-gray-200"} rounded-xl overflow-hidden`,children:a("img",{src:e,alt:`Miniatura ${t+1}`,className:"w-full h-full object-cover"})},e+t))}),r("div",{className:"absolute inset-0 flex items-center justify-between pointer-events-none",children:[a("button",{onClick:()=>_(-1),className:"p-3 bg-white/90 backdrop-blur-sm shadow-lg rounded-full pointer-events-auto transform -translate-x-2 hover:-translate-x-3 transition-all hover:bg-emerald-50",children:a(te,{className:"text-xl text-gray-700"})}),a("button",{onClick:()=>_(1),className:"p-3 bg-white/90 backdrop-blur-sm shadow-lg rounded-full pointer-events-auto transform translate-x-2 hover:translate-x-3 transition-all hover:bg-emerald-50",children:a(J,{className:"text-xl text-gray-700"})})]})]})]}),r("div",{className:"space-y-6",children:[p.length>0&&r("div",{children:[a("h3",{className:"text-lg font-bold mb-3 text-gray-800",children:"Colores disponibles"}),a("div",{className:"flex flex-wrap gap-3",children:p.map(e=>a("button",{onClick:()=>{I(e),w("")},className:`px-5 py-2.5 rounded-full border-2 transition-all ${n===e?"border-emerald-600 bg-emerald-50 font-bold text-emerald-700 shadow-md":"border-gray-200 hover:border-emerald-400 hover:shadow-sm"}`,children:e},e))})]}),d.length>0&&r("div",{children:[a("h3",{className:"text-lg font-bold mb-3 text-gray-800",children:"Tallas disponibles"}),a("div",{className:"flex flex-wrap gap-3",children:K.map(e=>{var l;const t=n?((l=h[n])==null?void 0:l[e])||0:s.stock;return a("button",{onClick:()=>w(e),disabled:t===0,className:`px-5 py-2.5 rounded-full border-2 transition-all ${c===e?"border-emerald-600 bg-emerald-50 font-bold text-emerald-700 shadow-md":"border-gray-200 hover:border-emerald-400 hover:shadow-sm"} ${t===0?"opacity-50 cursor-not-allowed":""}`,children:e},e)})})]})]})]}),r("div",{className:"space-y-6",children:[r("div",{className:"bg-gray-50 p-6 rounded-2xl shadow-sm border border-gray-100",children:[r("div",{className:"space-y-4",children:[r("div",{className:"flex items-baseline gap-4",children:[r("span",{className:"text-4xl font-bold text-gray-900",children:["$",D]}),s.discount>0&&r("div",{className:"flex flex-col",children:[r("span",{className:"text-gray-400 line-through text-xl",children:["$",s.price.toFixed(2)]}),r("div",{className:"flex gap-2 items-center text-emerald-600",children:[a(T,{className:"text-sm"}),r("span",{className:"font-bold",children:["Ahorras $",C(),(o==null?void 0:o.quantity)>1&&r("span",{children:[" ($",C(o.quantity)," total)"]})]})]})]})]}),a("div",{className:"flex items-center gap-2 text-sm",children:a("span",{className:"text-emerald-600 font-bold",children:"Envío gratis en 24/48h"})})]}),j?r("div",{className:"space-y-5 mt-6",children:[a("div",{className:"flex items-center gap-6",children:o?r(R,{children:[r("div",{className:"flex items-center gap-5 bg-white p-4 rounded-2xl shadow-sm",children:[a("button",{onClick:W,className:"p-3.5 bg-white border border-gray-200 rounded-xl hover:bg-red-50 hover:border-red-200 transition-all shadow-sm",disabled:o.quantity<=0,children:a(ae,{className:"text-red-600"})}),a("span",{className:"font-bold text-3xl text-gray-800 min-w-[2.5rem] text-center",children:o.quantity}),a("button",{onClick:O,className:"p-3.5 bg-white border border-gray-200 rounded-xl hover:bg-green-50 hover:border-green-200 transition-all shadow-sm",disabled:g<1,children:a(V,{className:"text-green-600"})})]}),r("div",{className:"flex flex-col",children:[r("span",{className:"text-xl font-bold text-gray-900",children:["Total: $",(D*o.quantity).toFixed(2)]}),s.discount>0&&r("span",{className:"text-sm font-medium text-emerald-600",children:["Ahorro total: $",C(o.quantity)]})]})]}):r("button",{onClick:O,className:"w-full bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-700 hover:to-emerald-600 text-white px-10 py-4 rounded-xl text-lg font-bold transition-all flex items-center justify-center gap-3 shadow-lg transform hover:-translate-y-0.5",disabled:g<1,children:[a(V,{className:"text-xl"}),"Añadir al carrito"]})}),(p.length>0||d.length>0)&&r("div",{className:"flex items-center gap-3 py-3",children:[a("span",{className:"font-bold text-gray-900",children:"Disponibilidad:"}),a("span",{className:`px-4 py-2 rounded-full text-sm font-bold ${g>0?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:g>0?`✔ ${g} disponibles`:"⛔ Stock agotado"})]})]}):a("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl shadow-sm border border-blue-100 mt-6",children:r("button",{className:"text-blue-800 hover:text-blue-900 font-bold flex items-center gap-2 text-lg",onClick:()=>b("/login"),children:["🔒 Inicia sesión para comprar",a(J,{className:"mt-1"})]})})]}),s.description&&r("div",{className:"pt-6 border-t border-gray-200",children:[a("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Descripción"}),a("div",{className:"prose prose-lg text-gray-600 space-y-4",children:s.description.split(`
`).map((e,t)=>a("p",{className:"leading-relaxed",children:e},t))})]}),Object.keys(P).length>0&&r("div",{className:"pt-6 border-t border-gray-200",children:[a("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Especificaciones"}),a("dl",{className:"grid grid-cols-2 gap-5",children:Object.entries(P).map(([e,t])=>r("div",{className:"col-span-1 bg-gray-50 p-3 rounded-lg",children:[r("dt",{className:"text-gray-500 capitalize text-sm",children:[e,":"]}),a("dd",{className:"font-bold text-gray-900",children:t})]},e))})]})]})]}),r("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[a("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"¿Por qué comprar con nosotros?"}),r("div",{className:"grid md:grid-cols-3 gap-6",children:[r("div",{className:"bg-white p-5 rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100 flex flex-col items-center text-center",children:[a("img",{src:re,alt:"Entrega rápida",className:"w-20 h-20 mb-4"}),r("div",{children:[a("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:"Entrega rápida"}),a("p",{className:"text-gray-600",children:"Recibe tu pedido en la puerta de tu casa más rápido que nunca."})]})]}),r("div",{className:"bg-white p-5 rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100 flex flex-col items-center text-center",children:[a("img",{src:se,alt:"Mejores precios y ofertas",className:"w-20 h-20 mb-4"}),r("div",{children:[a("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:"Mejores precios y ofertas"}),a("p",{className:"text-gray-600",children:"Los mejores precios con ofertas directas de los fabricantes."})]})]}),r("div",{className:"bg-white p-5 rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100 flex flex-col items-center text-center",children:[a("img",{src:le,alt:"Amplia variedad",className:"w-20 h-20 mb-4"}),r("div",{children:[a("h3",{className:"font-bold text-lg text-gray-900 mb-2",children:"Amplia variedad"}),a("p",{className:"text-gray-600",children:"Descubre más de 5,000 productos en cuidado personal, artículos para el hogar y más."})]})]})]})]})]})};export{ce as default};
