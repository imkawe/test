import{a as E,r as l,u as U,j as e,y as i,b as g}from"./index-BmcAolYd.js";const C="https://api.cloudinary.com/v1_1/dsho1poyl/image/upload",D="ml_unsigned",L=()=>{const{user:t,setUser:h}=E(),[d,b]=l.useState((t==null?void 0:t.name)||""),[u,f]=l.useState((t==null?void 0:t.role)||"user"),[c,y]=l.useState(null),[x,v]=l.useState((t==null?void 0:t.avatar)||null),[m,p]=l.useState(!1),j=U(),R=r=>{const s=r.target.files[0];y(s),v(URL.createObjectURL(s))},w=async r=>{if(r.preventDefault(),!d.trim()){i.error("⚠️ El nombre no puede estar vacío");return}p(!0);let s=t.avatar;if(c){const o=new FormData;o.append("file",c),o.append("upload_preset",D);try{s=(await g.post(C,o,{headers:{"Content-Type":"multipart/form-data"}})).data.secure_url}catch{i.error("❌ Error al subir la imagen"),p(!1);return}}try{const o=sessionStorage.getItem("authToken"),n={name:d,role:u,avatar:s};await g.put("http://localhost:8787/api/auth/update-profile",n,{headers:{Authorization:`Bearer ${o}`}}),h(S=>({...S,...n})),i.success("✅ Perfil actualizado correctamente"),j("/profile")}catch{i.error("❌ Error al actualizar perfil")}finally{p(!1)}};return e.jsxs("div",{style:a.container,children:[e.jsx("h2",{style:a.title,children:"Editar Perfil"}),e.jsxs("form",{onSubmit:w,style:a.form,children:[e.jsxs("label",{style:a.label,children:["Nombre:",e.jsx("input",{type:"text",value:d,onChange:r=>b(r.target.value),style:a.input})]}),e.jsxs("label",{style:a.label,children:["Rol:",e.jsx("input",{type:"text",value:u,onChange:r=>f(r.target.value)})]}),e.jsxs("label",{style:a.label,children:["Imagen de perfil:",e.jsx("input",{type:"file",onChange:R,style:a.input})]}),x&&e.jsx("img",{src:x,alt:"Vista previa",style:a.preview}),e.jsx("button",{type:"submit",disabled:m,style:a.button,children:m?"Guardando...":"Guardar"})]})]})},a={container:{maxWidth:"400px",margin:"20px auto",padding:"20px",background:"white",borderRadius:"10px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)"},title:{textAlign:"center"},form:{display:"flex",flexDirection:"column"},label:{marginBottom:"10px",fontWeight:"bold"},input:{padding:"10px",border:"1px solid #ddd",borderRadius:"5px",width:"100%"},preview:{width:"100px",height:"100px",borderRadius:"50%",objectFit:"cover",marginTop:"10px"},button:{background:"#4caf50",color:"white",padding:"10px",border:"none",borderRadius:"5px",cursor:"pointer",marginTop:"10px"}};export{L as default};
