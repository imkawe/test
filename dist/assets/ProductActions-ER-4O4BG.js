import{r as m,b as t,j as r,i as P,y as s,c as C,k as I,u as z}from"./index-CT1dYHP2.js";import{M as G}from"./index-DsbIybjs.js";const j=({initialData:a,onSubmit:h,isSubmitting:c})=>{const[i,u]=m.useState({name:"",image:[],unit:"",stock:"",price:"",discount:"",description:"",more_details:"{}",publish:!0,category_id:4}),[S,b]=m.useState(!1);m.useEffect(()=>{var n,o,l;a&&u({...a,stock:((n=a.stock)==null?void 0:n.toString())||"",price:((o=a.price)==null?void 0:o.toString())||"",discount:((l=a.discount)==null?void 0:l.toString())||"",more_details:typeof a.more_details=="string"?a.more_details:JSON.stringify(a.more_details)})},[a]);const g=async n=>{const o=n.target.files;if(!(o!=null&&o.length))return;b(!0);const l="dsho1poyl",f="ml_unsigned";try{const w=await Promise.all(Array.from(o).map(async v=>{const k=new FormData;return k.append("file",v),k.append("upload_preset",f),(await C.post(`https://api.cloudinary.com/v1_1/${l}/image/upload`,k)).data.secure_url}));u(v=>({...v,image:[...v.image,...w]})),s.success("¡Imágenes subidas!")}catch{s.error("Error subiendo imágenes")}b(!1)},y=n=>{u(o=>({...o,image:o.image.filter((l,f)=>f!==n)}))},d=n=>{const{name:o,value:l}=n.target;u(f=>({...f,[o]:l}))},x=n=>{if(n.preventDefault(),i.image.length===0)return s.warn("Sube al menos 1 imagen");if(i.discount>100||i.discount<0)return s.error("Descuento inválido");try{JSON.parse(i.more_details)}catch{return s.error("Formato JSON inválido en detalles adicionales")}const o={...i,stock:Number(i.stock),price:Number(i.price),discount:Number(i.discount),more_details:JSON.parse(i.more_details)};h(o)};return t("div",{style:e.container,children:[t("header",{style:e.header,children:[r("h1",{style:e.title,children:a?"Editar Producto":"Nuevo Producto"}),r("p",{style:e.subtitle,children:a?"Modifica los detalles del producto":"Registra los detalles de tu producto"})]}),t("form",{onSubmit:x,style:e.form,children:[t("div",{style:e.grid,children:[t("div",{style:e.formColumn,children:[t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Nombre del Producto*"}),r("input",{name:"name",value:i.name,onChange:d,style:e.input,placeholder:"Ej: Zapatos deportivos",required:!0})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Precio (USD)*"}),t("div",{style:e.inputWithSymbol,children:[r("span",{style:e.currency,children:"$"}),r("input",{type:"number",name:"price",value:i.price,onChange:d,style:{...e.input,paddingLeft:"32px"},min:"0",step:"0.01",required:!0})]})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Descuento (%)"}),r("input",{type:"number",name:"discount",value:i.discount,onChange:d,style:e.input,min:"0",max:"100",placeholder:"0-100%"})]})]}),t("div",{style:e.formColumn,children:[t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Stock Disponible*"}),r("input",{type:"number",name:"stock",value:i.stock,onChange:d,style:e.input,min:"0",placeholder:"Cantidad en inventario",required:!0})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Unidad de Medida*"}),r("div",{style:e.selectWrapper,children:t("select",{name:"unit",value:i.unit,onChange:d,style:e.select,required:!0,children:[r("option",{value:"",children:"Seleccionar unidad"}),r("option",{value:"unidad",children:"Unidad"}),r("option",{value:"par",children:"Par"}),r("option",{value:"kg",children:"Kilogramo"}),r("option",{value:"litro",children:"Litro"})]})})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Estado"}),t("div",{style:e.switchContainer,children:[t("label",{style:e.switch,children:[r("input",{type:"checkbox",checked:i.publish,onChange:n=>u(o=>({...o,publish:n.target.checked}))}),r("span",{style:e.slider})]}),r("span",{style:e.switchLabel,children:i.publish?"Público":"Oculto"})]})]})]})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Descripción Detallada*"}),r("textarea",{name:"description",value:i.description,onChange:d,style:{...e.input,...e.textarea},placeholder:"Describe características principales del producto",rows:4,required:!0})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Detalles Técnicos (JSON)*"}),r("textarea",{name:"more_details",value:i.more_details,onChange:d,style:{...e.input,...e.textarea},placeholder:'Ej: {"color": "rojo", "material": "cuero"}',required:!0})]}),t("div",{style:e.formGroup,children:[r("label",{style:e.label,children:"Imágenes del Producto*"}),t("div",{style:e.uploadArea,onClick:()=>document.getElementById("fileInput").click(),children:[r(P,{style:e.uploadIcon}),t("div",{style:e.uploadTextContainer,children:[r("p",{style:e.uploadMainText,children:S?"Subiendo...":"Arrastra tus imágenes aquí"}),r("p",{style:e.uploadSubText,children:"Formatos soportados: PNG, JPG (Máx. 10MB)"})]}),r("input",{type:"file",id:"fileInput",hidden:!0,multiple:!0,onChange:g,accept:"image/*"})]}),r("div",{style:e.imageGrid,children:i.image.map((n,o)=>t("div",{style:e.imageCard,children:[r("img",{src:n,alt:`Vista previa ${o}`,style:e.imagePreview}),r("button",{type:"button",style:e.deleteButton,onClick:()=>y(o),children:r(G,{style:e.deleteIcon})})]},o))})]}),r("button",{type:"submit",style:e.submitButton,disabled:c,children:c?a?"Guardando...":"Publicando...":a?"Guardar Cambios":"Publicar Producto"})]})]})},e={container:{maxWidth:"1000px",margin:"2rem auto",padding:"2rem",backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 8px 30px rgba(0,0,0,0.12)"},header:{textAlign:"center",marginBottom:"2rem"},title:{fontSize:"2rem",fontWeight:"700",color:"#1a202c",marginBottom:"0.5rem"},subtitle:{fontSize:"1rem",color:"#718096"},form:{display:"flex",flexDirection:"column",gap:"2rem"},grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem","@media (max-width: 768px)":{gridTemplateColumns:"1fr"}},formColumn:{display:"flex",flexDirection:"column",gap:"1.5rem"},formGroup:{display:"flex",flexDirection:"column",gap:"0.75rem"},label:{fontSize:"0.875rem",fontWeight:"600",color:"#2d3748"},input:{width:"100%",padding:"0.875rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",backgroundColor:"#f8fafc",transition:"all 0.2s ease",":focus":{outline:"none",borderColor:"#4299e1",boxShadow:"0 0 0 3px rgba(66, 153, 225, 0.2)"}},textarea:{height:"120px",resize:"vertical"},inputWithSymbol:{position:"relative"},currency:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#718096",fontSize:"1rem"},selectWrapper:{position:"relative"},select:{appearance:"none",width:"100%",padding:"0.875rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",backgroundColor:"#f8fafc"},switchContainer:{display:"flex",alignItems:"center",gap:"0.75rem"},switch:{position:"relative",display:"inline-block",width:"48px",height:"28px"},slider:{position:"absolute",cursor:"pointer",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"#e2e8f0",transition:"0.4s",borderRadius:"34px",":before":{position:"absolute",content:'""',height:"20px",width:"20px",left:"4px",bottom:"4px",backgroundColor:"white",transition:"0.4s",borderRadius:"50%"}},switchLabel:{fontSize:"0.875rem",color:"#4a5568"},uploadArea:{border:"2px dashed #cbd5e0",borderRadius:"12px",padding:"2rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:"#f8fafc",transition:"all 0.2s ease",minHeight:"180px",":hover":{borderColor:"#4299e1",backgroundColor:"#ebf8ff"}},uploadIcon:{fontSize:"2.5rem",color:"#718096",marginBottom:"1rem"},uploadTextContainer:{textAlign:"center"},uploadMainText:{color:"#2d3748",fontWeight:"500",margin:"0"},uploadSubText:{color:"#718096",fontSize:"0.875rem",margin:"0.5rem 0 0"},imageGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"1rem",marginTop:"1.5rem"},imageCard:{position:"relative",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"transform 0.2s ease",":hover":{transform:"translateY(-2px)"}},imagePreview:{width:"100%",height:"150px",objectFit:"cover"},deleteButton:{position:"absolute",top:"8px",right:"8px",background:"rgba(255,255,255,0.9)",borderRadius:"50%",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",border:"none",cursor:"pointer"},deleteIcon:{color:"#e53e3e",fontSize:"1.25rem"},submitButton:{width:"100%",padding:"1rem",backgroundColor:"#4299e1",color:"white",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#3182ce"},":disabled":{opacity:"0.7",cursor:"not-allowed"}}},R=({actionType:a})=>{const{id:h}=I(),c=z(),[i,u]=m.useState(null),[S,b]=m.useState(!0),[g,y]=m.useState(!1);m.useEffect(()=>{a!=="create"&&(async()=>{try{const n=await C.get(`https://cloudflare-d1.ujhuji.workers.dev/api/products/${h}`);u(n.data)}catch{s.error("Error cargando producto"),c("/products")}finally{b(!1)}})()},[h,a,c]);const d=async x=>{var n,o;y(!0);try{const l=sessionStorage.getItem("authToken");a==="edit"?(await C.put(`https://cloudflare-d1.ujhuji.workers.dev/api/products/${h}`,x,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}),s.success("Producto actualizado correctamente")):a==="delete"&&(await C.delete(`https://cloudflare-d1.ujhuji.workers.dev/api/products/${h}`,{headers:{Authorization:`Bearer ${l}`}}),s.success("Producto eliminado correctamente")),c("/products")}catch(l){s.error(((o=(n=l.response)==null?void 0:n.data)==null?void 0:o.error)||"Error en la operación")}finally{y(!1)}};return S?r("div",{style:p.loading,children:"Cargando..."}):a==="delete"?t("div",{style:p.confirmationContainer,children:[r("h2",{style:p.confirmationTitle,children:"¿Eliminar producto?"}),t("p",{style:p.confirmationText,children:["Estás a punto de eliminar: ",r("strong",{children:i.name})]}),t("div",{style:p.buttonGroup,children:[r("button",{style:p.cancelButton,onClick:()=>c("/products"),children:"Cancelar"}),r("button",{style:p.deleteButton,onClick:()=>d(),disabled:g,children:g?"Eliminando...":"Confirmar Eliminación"})]})]}):r(j,{initialData:i,onSubmit:d,isSubmitting:g})},p={loading:{textAlign:"center",fontSize:"1.2rem",color:"#4a5568",padding:"2rem"},confirmationContainer:{maxWidth:"600px",margin:"2rem auto",padding:"2rem",backgroundColor:"#fff",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.08)",textAlign:"center"},confirmationTitle:{fontSize:"1.8rem",color:"#2d3748",marginBottom:"1rem"},confirmationText:{fontSize:"1.1rem",color:"#718096",marginBottom:"2rem"},buttonGroup:{display:"flex",justifyContent:"center",gap:"1rem",marginTop:"1.5rem"},cancelButton:{padding:"0.8rem 1.5rem",backgroundColor:"#e2e8f0",color:"#2d3748",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#cbd5e0"}},deleteButton:{padding:"0.8rem 1.5rem",backgroundColor:"#e53e3e",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#c53030"}}};export{R as default};
