import{r as p,j as e,F as k,y as l,b as j,c as w,u as P}from"./index-BmcAolYd.js";import{M as I}from"./index-B7bUr05O.js";const z=({initialData:n,onSubmit:m,isSubmitting:d})=>{const[o,c]=p.useState({name:"",image:[],unit:"",stock:"",price:"",discount:"",description:"",more_details:"{}",publish:!0,category_id:4}),[v,g]=p.useState(!1);p.useEffect(()=>{var i,t,s;n&&c({...n,stock:((i=n.stock)==null?void 0:i.toString())||"",price:((t=n.price)==null?void 0:t.toString())||"",discount:((s=n.discount)==null?void 0:s.toString())||"",more_details:typeof n.more_details=="string"?n.more_details:JSON.stringify(n.more_details)})},[n]);const h=async i=>{const t=i.target.files;if(!(t!=null&&t.length))return;g(!0);const s="dsho1poyl",x="ml_unsigned";try{const S=await Promise.all(Array.from(t).map(async y=>{const C=new FormData;return C.append("file",y),C.append("upload_preset",x),(await j.post(`https://api.cloudinary.com/v1_1/${s}/image/upload`,C)).data.secure_url}));c(y=>({...y,image:[...y.image,...S]})),l.success("¡Imágenes subidas!")}catch{l.error("Error subiendo imágenes")}g(!1)},f=i=>{c(t=>({...t,image:t.image.filter((s,x)=>x!==i)}))},a=i=>{const{name:t,value:s}=i.target;c(x=>({...x,[t]:s}))},b=i=>{if(i.preventDefault(),o.image.length===0)return l.warn("Sube al menos 1 imagen");if(o.discount>100||o.discount<0)return l.error("Descuento inválido");try{JSON.parse(o.more_details)}catch{return l.error("Formato JSON inválido en detalles adicionales")}const t={...o,stock:Number(o.stock),price:Number(o.price),discount:Number(o.discount),more_details:JSON.parse(o.more_details)};m(t)};return e.jsxs("div",{style:r.container,children:[e.jsxs("header",{style:r.header,children:[e.jsx("h1",{style:r.title,children:n?"Editar Producto":"Nuevo Producto"}),e.jsx("p",{style:r.subtitle,children:n?"Modifica los detalles del producto":"Registra los detalles de tu producto"})]}),e.jsxs("form",{onSubmit:b,style:r.form,children:[e.jsxs("div",{style:r.grid,children:[e.jsxs("div",{style:r.formColumn,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Nombre del Producto*"}),e.jsx("input",{name:"name",value:o.name,onChange:a,style:r.input,placeholder:"Ej: Zapatos deportivos",required:!0})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Precio (USD)*"}),e.jsxs("div",{style:r.inputWithSymbol,children:[e.jsx("span",{style:r.currency,children:"$"}),e.jsx("input",{type:"number",name:"price",value:o.price,onChange:a,style:{...r.input,paddingLeft:"32px"},min:"0",step:"0.01",required:!0})]})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Descuento (%)"}),e.jsx("input",{type:"number",name:"discount",value:o.discount,onChange:a,style:r.input,min:"0",max:"100",placeholder:"0-100%"})]})]}),e.jsxs("div",{style:r.formColumn,children:[e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Stock Disponible*"}),e.jsx("input",{type:"number",name:"stock",value:o.stock,onChange:a,style:r.input,min:"0",placeholder:"Cantidad en inventario",required:!0})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Unidad de Medida*"}),e.jsx("div",{style:r.selectWrapper,children:e.jsxs("select",{name:"unit",value:o.unit,onChange:a,style:r.select,required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar unidad"}),e.jsx("option",{value:"unidad",children:"Unidad"}),e.jsx("option",{value:"par",children:"Par"}),e.jsx("option",{value:"kg",children:"Kilogramo"}),e.jsx("option",{value:"litro",children:"Litro"})]})})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Estado"}),e.jsxs("div",{style:r.switchContainer,children:[e.jsxs("label",{style:r.switch,children:[e.jsx("input",{type:"checkbox",checked:o.publish,onChange:i=>c(t=>({...t,publish:i.target.checked}))}),e.jsx("span",{style:r.slider})]}),e.jsx("span",{style:r.switchLabel,children:o.publish?"Público":"Oculto"})]})]})]})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Descripción Detallada*"}),e.jsx("textarea",{name:"description",value:o.description,onChange:a,style:{...r.input,...r.textarea},placeholder:"Describe características principales del producto",rows:4,required:!0})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Detalles Técnicos (JSON)*"}),e.jsx("textarea",{name:"more_details",value:o.more_details,onChange:a,style:{...r.input,...r.textarea},placeholder:'Ej: {"color": "rojo", "material": "cuero"}',required:!0})]}),e.jsxs("div",{style:r.formGroup,children:[e.jsx("label",{style:r.label,children:"Imágenes del Producto*"}),e.jsxs("div",{style:r.uploadArea,onClick:()=>document.getElementById("fileInput").click(),children:[e.jsx(k,{style:r.uploadIcon}),e.jsxs("div",{style:r.uploadTextContainer,children:[e.jsx("p",{style:r.uploadMainText,children:v?"Subiendo...":"Arrastra tus imágenes aquí"}),e.jsx("p",{style:r.uploadSubText,children:"Formatos soportados: PNG, JPG (Máx. 10MB)"})]}),e.jsx("input",{type:"file",id:"fileInput",hidden:!0,multiple:!0,onChange:h,accept:"image/*"})]}),e.jsx("div",{style:r.imageGrid,children:o.image.map((i,t)=>e.jsxs("div",{style:r.imageCard,children:[e.jsx("img",{src:i,alt:`Vista previa ${t}`,style:r.imagePreview}),e.jsx("button",{type:"button",style:r.deleteButton,onClick:()=>f(t),children:e.jsx(I,{style:r.deleteIcon})})]},t))})]}),e.jsx("button",{type:"submit",style:r.submitButton,disabled:d,children:d?n?"Guardando...":"Publicando...":n?"Guardar Cambios":"Publicar Producto"})]})]})},r={container:{maxWidth:"1000px",margin:"2rem auto",padding:"2rem",backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 8px 30px rgba(0,0,0,0.12)"},header:{textAlign:"center",marginBottom:"2rem"},title:{fontSize:"2rem",fontWeight:"700",color:"#1a202c",marginBottom:"0.5rem"},subtitle:{fontSize:"1rem",color:"#718096"},form:{display:"flex",flexDirection:"column",gap:"2rem"},grid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem","@media (max-width: 768px)":{gridTemplateColumns:"1fr"}},formColumn:{display:"flex",flexDirection:"column",gap:"1.5rem"},formGroup:{display:"flex",flexDirection:"column",gap:"0.75rem"},label:{fontSize:"0.875rem",fontWeight:"600",color:"#2d3748"},input:{width:"100%",padding:"0.875rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",backgroundColor:"#f8fafc",transition:"all 0.2s ease",":focus":{outline:"none",borderColor:"#4299e1",boxShadow:"0 0 0 3px rgba(66, 153, 225, 0.2)"}},textarea:{height:"120px",resize:"vertical"},inputWithSymbol:{position:"relative"},currency:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#718096",fontSize:"1rem"},selectWrapper:{position:"relative"},select:{appearance:"none",width:"100%",padding:"0.875rem 1rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",backgroundColor:"#f8fafc"},switchContainer:{display:"flex",alignItems:"center",gap:"0.75rem"},switch:{position:"relative",display:"inline-block",width:"48px",height:"28px"},slider:{position:"absolute",cursor:"pointer",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"#e2e8f0",transition:"0.4s",borderRadius:"34px",":before":{position:"absolute",content:'""',height:"20px",width:"20px",left:"4px",bottom:"4px",backgroundColor:"white",transition:"0.4s",borderRadius:"50%"}},switchLabel:{fontSize:"0.875rem",color:"#4a5568"},uploadArea:{border:"2px dashed #cbd5e0",borderRadius:"12px",padding:"2rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:"#f8fafc",transition:"all 0.2s ease",minHeight:"180px",":hover":{borderColor:"#4299e1",backgroundColor:"#ebf8ff"}},uploadIcon:{fontSize:"2.5rem",color:"#718096",marginBottom:"1rem"},uploadTextContainer:{textAlign:"center"},uploadMainText:{color:"#2d3748",fontWeight:"500",margin:"0"},uploadSubText:{color:"#718096",fontSize:"0.875rem",margin:"0.5rem 0 0"},imageGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"1rem",marginTop:"1.5rem"},imageCard:{position:"relative",borderRadius:"8px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"transform 0.2s ease",":hover":{transform:"translateY(-2px)"}},imagePreview:{width:"100%",height:"150px",objectFit:"cover"},deleteButton:{position:"absolute",top:"8px",right:"8px",background:"rgba(255,255,255,0.9)",borderRadius:"50%",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",border:"none",cursor:"pointer"},deleteIcon:{color:"#e53e3e",fontSize:"1.25rem"},submitButton:{width:"100%",padding:"1rem",backgroundColor:"#4299e1",color:"white",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#3182ce"},":disabled":{opacity:"0.7",cursor:"not-allowed"}}},_=({actionType:n})=>{const{id:m}=w(),d=P(),[o,c]=p.useState(null),[v,g]=p.useState(!0),[h,f]=p.useState(!1);p.useEffect(()=>{n!=="create"&&(async()=>{try{const i=await j.get(`http://localhost:8787/api/products/${m}`);c(i.data)}catch{l.error("Error cargando producto"),d("/products")}finally{g(!1)}})()},[m,n,d]);const a=async b=>{var i,t;f(!0);try{const s=sessionStorage.getItem("authToken");n==="edit"?(await j.put(`http://localhost:8787/api/products/${m}`,b,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}),l.success("Producto actualizado correctamente")):n==="delete"&&(await j.delete(`http://localhost:8787/api/products/${m}`,{headers:{Authorization:`Bearer ${s}`}}),l.success("Producto eliminado correctamente")),d("/products")}catch(s){l.error(((t=(i=s.response)==null?void 0:i.data)==null?void 0:t.error)||"Error en la operación")}finally{f(!1)}};return v?e.jsx("div",{style:u.loading,children:"Cargando..."}):n==="delete"?e.jsxs("div",{style:u.confirmationContainer,children:[e.jsx("h2",{style:u.confirmationTitle,children:"¿Eliminar producto?"}),e.jsxs("p",{style:u.confirmationText,children:["Estás a punto de eliminar: ",e.jsx("strong",{children:o.name})]}),e.jsxs("div",{style:u.buttonGroup,children:[e.jsx("button",{style:u.cancelButton,onClick:()=>d("/products"),children:"Cancelar"}),e.jsx("button",{style:u.deleteButton,onClick:()=>a(),disabled:h,children:h?"Eliminando...":"Confirmar Eliminación"})]})]}):e.jsx(z,{initialData:o,onSubmit:a,isSubmitting:h})},u={loading:{textAlign:"center",fontSize:"1.2rem",color:"#4a5568",padding:"2rem"},confirmationContainer:{maxWidth:"600px",margin:"2rem auto",padding:"2rem",backgroundColor:"#fff",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.08)",textAlign:"center"},confirmationTitle:{fontSize:"1.8rem",color:"#2d3748",marginBottom:"1rem"},confirmationText:{fontSize:"1.1rem",color:"#718096",marginBottom:"2rem"},buttonGroup:{display:"flex",justifyContent:"center",gap:"1rem",marginTop:"1.5rem"},cancelButton:{padding:"0.8rem 1.5rem",backgroundColor:"#e2e8f0",color:"#2d3748",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#cbd5e0"}},deleteButton:{padding:"0.8rem 1.5rem",backgroundColor:"#e53e3e",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",":hover":{backgroundColor:"#c53030"}}};export{_ as default};
