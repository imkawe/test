import{a as R,r as o,u as k,b as a,j as e,h as U,y as i,c as h}from"./index-CT1dYHP2.js";const E="https://api.cloudinary.com/v1_1/dsho1poyl/image/upload",I="ml_unsigned",L=()=>{const{user:t,setUser:g}=R(),[c,x]=o.useState((t==null?void 0:t.name)||""),[u,v]=o.useState((t==null?void 0:t.role)||""),[m,y]=o.useState((t==null?void 0:t.mobile)||""),[p,w]=o.useState(null),[b,N]=o.useState((t==null?void 0:t.avatar)||null),[f,d]=o.useState(!1),C=k();return a("div",{className:"max-w-md mx-auto my-6 p-4 bg-white rounded-lg shadow-md",children:[e("h2",{className:"text-xl font-semibold text-gray-800 mb-4 text-center",children:"Editar Perfil"}),a("form",{onSubmit:async r=>{if(r.preventDefault(),!c.trim()){i.error("⚠️ El nombre no puede estar vacío");return}d(!0);let s=t.avatar;if(p){const l=new FormData;l.append("file",p),l.append("upload_preset",I);try{s=(await h.post(E,l,{headers:{"Content-Type":"multipart/form-data"}})).data.secure_url}catch{i.error("❌ Error al subir la imagen"),d(!1);return}}try{const l=sessionStorage.getItem("authToken"),n={name:c,role:u,mobile:m,avatar:s};await h.put("https://cloudflare-d1.ujhuji.workers.dev/api/user/update-profile",n,{headers:{Authorization:`Bearer ${l}`}}),g(S=>({...S,...n})),i.success("✅ Perfil actualizado correctamente"),C("/profile")}catch{i.error("❌ Error al actualizar perfil")}finally{d(!1)}},className:"space-y-3",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e("input",{type:"text",value:c,onChange:r=>x(r.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"Tu nombre completo"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),a("select",{value:u,onChange:r=>v(r.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",children:[e("option",{value:"USER",children:"Usuario"}),e("option",{value:"ADMIN",children:"Administrador"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e("input",{type:"tel",value:m,onChange:r=>y(r.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"+34 123 456 789",pattern:"[+]?[0-9\\s]+"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Imagen de perfil"}),a("div",{className:"flex items-center gap-2",children:[e("input",{type:"file",onChange:r=>{const s=r.target.files[0];w(s),N(URL.createObjectURL(s))},className:"block w-full text-xs text-gray-500\r file:mr-2 file:py-1.5 file:px-3\r file:rounded file:border-0\r file:text-xs file:font-semibold\r file:bg-blue-50 file:text-blue-700\r hover:file:bg-blue-100"}),b&&e("img",{src:b,alt:"Vista previa",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-200"})]})]}),e("button",{type:"submit",disabled:f,className:"w-full bg-blue-600 text-white px-4 py-2 rounded\r hover:bg-blue-700 transition-colors disabled:bg-blue-400\r disabled:cursor-not-allowed flex justify-center items-center gap-1.5 text-sm",children:f?a(U,{children:[a("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):"Guardar cambios"})]})]})};export{L as default};
