import{a as b,r as l,j as e,b as a,z as h,A as v,c as E,y as C,B as _,C as k,D as O}from"./index-CT1dYHP2.js";import D from"./OrderDetail-B0Ga34SP.js";const j=()=>{const{user:d}=b(),[o,p]=l.useState([]),[u,g]=l.useState(!0),[f,m]=l.useState(null),[x,y]=l.useState(null);l.useEffect(()=>{d&&(async()=>{var r,i,c;try{const{data:n}=await E.get("https://cloudflare-d1.ujhuji.workers.dev/api/orders",{headers:{Authorization:`Bearer ${sessionStorage.getItem("authToken")}`}}),w=((r=n.data)==null?void 0:r.filter(s=>s.user_id!==d.id?!1:!!(s.metodo_de_pago==="cash"||s.payment_id&&s.status==="COMPLETED")).map(s=>({...s,created_at:new Date(s.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"})})))||[];p(w)}catch(n){y(((c=(i=n.response)==null?void 0:i.data)==null?void 0:c.error)||"Error al cargar las órdenes"),C.error("Error al cargar el historial de pedidos")}finally{g(!1)}})()},[d]);const N=t=>{const r={PENDING:{color:"bg-yellow-100 text-yellow-800",icon:e(O,{className:"mr-2"})},COMPLETED:{color:"bg-green-100 text-green-800",icon:e(k,{className:"mr-2"})},CANCELLED:{color:"bg-red-100 text-red-800",icon:e(_,{className:"mr-2"})}},{color:i,icon:c}=r[t]||{color:"bg-gray-100 text-gray-800"};return a("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${i}`,children:[c,t]})};return u?e("div",{className:"min-h-screen flex items-center justify-center",children:e("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):x?e("div",{className:"max-w-6xl mx-auto p-4",children:e("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:a("div",{className:"flex",children:[e("div",{className:"flex-shrink-0",children:e("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e("div",{className:"ml-3",children:e("p",{className:"text-sm text-red-700",children:x})})]})})}):a("div",{className:"max-w-6xl mx-auto p-4",children:[e("div",{className:"flex items-center justify-between mb-8",children:a("h1",{className:"text-3xl font-bold flex items-center",children:[e(h,{className:"mr-2 text-blue-600"}),"Mis Pedidos"]})}),o.length===0?a("div",{className:"text-center py-12",children:[e(h,{className:"mx-auto h-12 w-12 text-gray-400"}),e("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"No hay pedidos registrados"}),e("p",{className:"mt-1 text-gray-500",children:"Tus futuros pedidos aparecerán aquí"})]}):e("div",{className:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm",children:a("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID Pedido"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Método de Pago"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(t=>{var r;return a("tr",{className:"hover:bg-gray-50 transition-colors",children:[a("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",t.order_id]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.created_at}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:N(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.metodo_de_pago==="cash"?"Efectivo":t.payment_id?"PayPal":"No especificado"}),a("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:["$",(r=t.total_amt)==null?void 0:r.toFixed(2)]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a("button",{onClick:()=>m(t),className:"text-blue-600 hover:text-blue-900 flex items-center justify-end w-full",children:[e(v,{className:"mr-2"}),"Ver Detalles"]})})]},t.order_id)})})]})}),e(D,{order:f,onClose:()=>m(null)})]})};export{j as default};
